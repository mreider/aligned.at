window.initBlueskyComments=async function(e,t){console.log("Initializing Bluesky comments with options:",t);const n=document.getElementById(e);if(!n){console.error(`Element with ID "${e}" not found.`);return}const o=e=>{if(!e.startsWith("at://")&&e.includes("bsky.app/profile/")){const t=e.match(/profile\/([\w.]+)\/post\/([\w]+)/);if(t){const[,e,n]=t;return`at://${e}/app.bsky.feed.post/${n}`}}return e},i=async e=>{const t=o(e),n=new URLSearchParams({uri:t}),s=`https://public.api.bsky.app/xrpc/app.bsky.feed.getPostThread?${n.toString()}`;try{const e=await fetch(s,{method:"GET",headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`Failed to fetch post thread: ${e.statusText}`);return await e.json()}catch(e){return console.error(e),null}},a=(e,t)=>{if(!e||!e.replies||e.replies.length===0){t.innerHTML="<p>No comments yet. Be the first to reply on Bluesky!</p>";return}const n=e.replies.sort((e,t)=>(t.post.likeCount??0)-(e.post.likeCount??0)),s=n.map(e=>{const t=e.post.author,n=t.avatar?`<img src="${t.avatar}" alt="${t.handle}" />`:`<div class="avatar-placeholder"></div>`;return`
              <div class="comment">
                  <div class="comment-header">
                      <a href="https://bsky.app/profile/${t.did}" target="_blank">${n} <span>${t.displayName??t.handle}</span></a>
                  </div>
                  <div class="comment-body">
                      <p>${e.post.record.text}</p>
                      <a href="https://bsky.app/profile/${t.did}/post/${e.post.uri.split("/").pop()}" target="_blank">View on Bluesky</a>
                  </div>
              </div>`}).join("");t.innerHTML=`
          <div class="comments-container">
              ${s}
          </div>`},s=await i(t.uri);s?a(s.thread,n):n.innerHTML="<p>Unable to load comments. Try again later.</p>"}